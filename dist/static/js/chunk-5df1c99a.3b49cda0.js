(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-5df1c99a"],{"6a6c":function(t,e,a){},9146:function(t,e,a){"use strict";a("6a6c")},c9ec:function(t,e,a){"use strict";a.r(e);var l=function(){var t=this,e=t._self._c;return e("div",{staticClass:"container"},[e("div",{staticClass:"widget"},[e("el-tabs",{attrs:{type:"border-card"}},[e("el-tab-pane",[e("span",{attrs:{slot:"label"},slot:"label"},[e("i",{staticClass:"el-icon-edit"}),t._v("添加镜像")]),t._v(" "),e("el-form",{ref:"build",attrs:{model:t.buildForm,inline:"",size:"mini",rules:t.rules}},[e("el-form-item",{attrs:{label:"名称",prop:"tag"}},[e("el-input",{attrs:{placeholder:"eg. redis:latest"},model:{value:t.buildForm.tag,callback:function(e){t.$set(t.buildForm,"tag",e)},expression:"buildForm.tag"}})],1)],1),t._v(" "),e("el-tabs",{ref:"tab",attrs:{value:"dockerfile"}},[e("el-tab-pane",{attrs:{name:"dockerfile"}},[e("span",{attrs:{slot:"label"},slot:"label"},[e("i",{staticClass:"el-icon-edit"}),t._v(" DockerFile")]),t._v(" "),e("div",[e("el-form",[e("el-form-item",[e("el-input",{attrs:{type:"textarea",rows:"10",placeholder:"Define or paste the content of Your Dockerfile here"},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1)],1)],1)]),t._v(" "),e("el-tab-pane",{attrs:{name:"tar"}},[e("span",{attrs:{slot:"label"},slot:"label"},[e("i",{staticClass:"el-icon-upload2"}),t._v(" 上传")]),t._v(" "),e("div",[e("div",[e("el-upload",{ref:"upload",attrs:{accept:"*.tar","on-change":t.getFile,action:"","auto-upload":!1}},[e("el-button",{attrs:{size:"mini",type:"primary"}},[t._v("选择文件")])],1)],1)])]),t._v(" "),e("el-tab-pane",{attrs:{name:"pull"}},[e("span",{attrs:{slot:"label"},slot:"label"},[e("i",{staticClass:"el-icon-edit"}),t._v("Pull")])])],1),t._v(" "),e("div",[e("div",{staticClass:"wd-title"},[t._v("Actions")]),t._v(" "),e("div",{staticClass:"action-group"},[e("el-button",{attrs:{type:"primary",size:"mini"},on:{click:t.build}},[t._v("上传/编译")])],1)])],1),t._v(" "),e("el-tab-pane",{attrs:{disabled:!t.showLog}},[e("span",{attrs:{slot:"label"},slot:"label"},[e("i",{staticClass:"el-icon-document"}),t._v("日志")]),t._v(" "),e("div",{staticClass:"output",staticStyle:{"max-height":"300px",overflow:"auto"},attrs:{id:"log_output"}},[e("pre",{staticClass:"pre"},[t._v("             "),t._l(t.output,(function(a){return e("code",{staticClass:"line small"},[t._v(t._s(a))])})),t._v("\n            ")],2)])])],1)],1)])},s=[],i=a("e876"),o={name:"addImage",data:function(){return{rules:{tag:[{required:!0,max:100,min:2,message:"请输入要构建的镜像名称"}]},selectHub:"DockerHub",imageName:"",buildForm:{tag:""},options:[{value:"DockerHub",label:"DockerHub"}],file:null,output:[],pk:null,content:"",listTotal:0,listData:[],showLog:!1}},created:function(){this.pk=this.$route.query.id},methods:{getFile:function(t,e){e.length>1&&e.splice(0,1),this.file=t.raw},build:function(){var t=this;this.$refs["build"].validate((function(e){if(!e)return!1;var a;"tar"===t.$refs.tab.currentName?(a=new FormData,a.append("type","tar"),a.append("files",t.file)):a="pull"===t.$refs.tab.currentName?{tag:t.imageName}:{dockerfile:t.content,tag:t.tag},i["a"].post("/api/admin/docker/image?build_type=".concat(t.$refs.tab.currentName,"&tag=").concat(t.buildForm.tag),a).then((function(e){t.$message({message:"任务已提交",type:"success"}),t.showLog=!0,t.output=[],t.loopResponse(e.data.task)})).catch((function(t){}))}))},loopResponse:function(t){var e,a=this,l={index:this.output.length};i["a"].get("/api/admin/task/".concat(t,"/log"),l).then((function(l){a.output=a.output.concat(l.data);var s=document.getElementById("log_output");s.scrollTop=s.scrollHeight,l.end?clearTimeout(e):e=setTimeout((function(){a.loopResponse(t)}),5e3)}))}}},n=o,r=(a("9146"),a("2877")),c=Object(r["a"])(n,l,s,!1,null,"4e920a1e",null);e["default"]=c.exports}}]);